# ES Guard MenuBar App è®¡åˆ’ä¹¦

## 1. é¡¹ç›®ç›®æ ‡

åœ¨ `codex-es-guard` é¡¹ç›®ä¸­æ„å»ºä¸€ä¸ª**ç‹¬ç«‹çš„ macOS MenuBar åº”ç”¨**ï¼Œè®©ç”¨æˆ·é€šè¿‡èœå•æ å®æ—¶ç›‘æ§ ES Guard å®ˆæŠ¤è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€æ‹¦æˆªè®°å½•ã€ä¿æŠ¤ç­–ç•¥ï¼Œå¹¶æä¾›ä¸€é”®æ”¾è¡Œç­‰äº¤äº’èƒ½åŠ›ã€‚

## 2. è®¾è®¡å‚è€ƒ

å€Ÿé‰´ `cliProxyAPI-Dashboard/macos-menubar/CLIProxyMenuBar` çš„ UI é£æ ¼å’Œæ¶æ„æ¨¡å¼ï¼š

| å‚è€ƒç‚¹ | cliProxyAPI-Dashboard å®ç° | ES Guard åº”ç”¨é€‚é… |
|--------|---------------------------|------------------|
| å…¥å£ | `@main` + `MenuBarExtra(.window)` | ç›¸åŒæ¨¡å¼ |
| çª—å£å®½åº¦ | `.frame(width: 400)` | ä¿æŒ 400pt |
| Tab å¯¼èˆª | `Picker(.segmented)` + `enum` | ç›¸åŒæ¨¡å¼ |
| å­—ä½“ä½“ç³» | `.headline` æ ‡é¢˜ / `.callout` æ­£æ–‡ / `.caption` è¾…åŠ© / `.system(size:10-11, design:.monospaced)` æ—¥å¿— | ä¿æŒä¸€è‡´ |
| é¢œè‰²è¯­ä¹‰ | `.primary` æ­£æ–‡ / `.secondary` è¾…åŠ© / `.orange` è­¦å‘Š / `.red` é”™è¯¯ / `.green` æˆåŠŸ / `.blue` ä¿¡æ¯ | ä¿æŒä¸€è‡´ |
| åº•éƒ¨æ  | åˆ·æ–° / æš‚åœ / é€€å‡ºæŒ‰é’® | æ”¹ä¸º åˆ·æ–° / é€€å‡º |
| æ•°æ®åˆ·æ–° | è½®è¯¢ (`Task.sleep` å¾ªç¯) | ç›¸åŒæ¨¡å¼ï¼Œ5ç§’é—´éš” |
| çŠ¶æ€ç®¡ç† | `@StateObject` ViewModel + `@Published` å±æ€§ | ç›¸åŒæ¨¡å¼ |
| æœ€å°macOS | `.macOS(.v13)` | `.macOS(.v13)` |

## 3. æ•°æ®æº

æ‰€æœ‰æ•°æ®å‡æ¥è‡ªæœ¬åœ°æ–‡ä»¶ï¼Œ**ä¸éœ€è¦ç½‘ç»œè¯·æ±‚**ï¼š

| æ•°æ® | æ¥æº | æ ¼å¼ |
|------|------|------|
| å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€ | `pgrep -x codex-es-guard` | è¿›ç¨‹æ˜¯å¦å­˜åœ¨ |
| æ‹¦æˆªè®°å½• | `~/.codex/es-guard/denials.jsonl` | æ¯è¡Œä¸€ä¸ª JSON |
| æœ€æ–°æ‹¦æˆªåé¦ˆ | `~/.codex/es-guard/last_denial.txt` | äººç±»å¯è¯»æ–‡æœ¬ |
| ä¿æŠ¤ç­–ç•¥ | `~/.codex/es_policy.json` | JSON |
| å®ˆæŠ¤è¿›ç¨‹æ—¥å¿— | `/tmp/codex-es-guard.log` + `.err` | æ–‡æœ¬è¡Œ |

### 3.1 denials.jsonl è®°å½•æ ¼å¼

```json
{
  "ts": 1772096243,
  "op": "unlink",
  "path": "/Users/jqwang/100-test-guard/codex-test.txt",
  "dest": null,
  "zone": "/Users/jqwang/1",
  "process": "rm",
  "ancestor": "codex"
}
```

### 3.2 es_policy.json ç­–ç•¥æ ¼å¼

```json
{
  "protected_zones": ["/Users/jqwang/0", "/Users/jqwang/1", ...],
  "temporary_overrides": ["/path/to/temporarily/allowed/file"]
}
```

è¿è¡Œæ—¶è¿˜æœ‰å†…ç½®é»˜è®¤å€¼ï¼ˆä¸åœ¨ JSON ä¸­ï¼‰ï¼š
- `trusted_tools`: git, cargo, npm, node, python3, swift ç­‰
- `ai_agent_patterns`: codex, claude, claude-code

## 4. åŠŸèƒ½è§„åˆ’

### Tab 1: çŠ¶æ€ï¼ˆStatusï¼‰

**æ ¸å¿ƒçœ‹æ¿é¡µ**ï¼Œä¸€çœ¼æŒæ¡å…¨å±€ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â— ES Guard: Running        12 æ‹¦æˆª  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â± è¿è¡Œæ—¶é—´  è‡ª 2026-02-26 10:00     â”‚
â”‚  ğŸ—‘ DELETE    8                       â”‚
â”‚  â¡ MOVE      4                       â”‚
â”‚  ğŸ¤– Agents   claude, codex           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  æœ€æ–°æ‹¦æˆª (30s ago)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ DELETE rm (via claude)         â”‚  â”‚
â”‚  â”‚ /Users/.../important.rs       â”‚  â”‚
â”‚  â”‚ Zone: /Users/jqwang/0         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  [ Override: important.rs ]          â”‚
â”‚  âœ“ Override granted                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å†…å®¹ï¼š
- å®ˆæŠ¤è¿›ç¨‹è¿è¡ŒçŠ¶æ€ï¼ˆç»¿è‰²/çº¢è‰²æŒ‡ç¤ºç¯ + æ–‡å­—ï¼‰
- æ‹¦æˆªç»Ÿè®¡ï¼šæ€»æ•°ã€æŒ‰ç±»å‹(delete/move)ã€æ¶‰åŠçš„ Agent
- æœ€æ–°ä¸€æ¡æ‹¦æˆªçš„è¯¦æƒ…ï¼ˆæ¥è‡ª `last_denial.txt`ï¼‰
- ä¸€é”® Override æŒ‰é’®ï¼ˆè°ƒç”¨ `es-guard-override`ï¼‰
- Override ç»“æœåé¦ˆ

### Tab 2: è®°å½•ï¼ˆRecordsï¼‰

**æ‹¦æˆªå†å²åˆ—è¡¨**ï¼Œå¯æ»šåŠ¨æµè§ˆã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‹¦æˆªè®°å½• (12)          [ä»…DELETE â–¼]  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  DELETE  codex-test.txt    via codex â”‚
â”‚  /Users/.../codex-test.txt  14:30:43 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  DELETE  build.db       via claude   â”‚
â”‚  /Users/.../.build/build.db 14:23:08 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  MOVE    config.bak      via claude  â”‚
â”‚  /Users/.../config â†’ /tmp/  14:20:15 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  ...                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å†…å®¹ï¼š
- æŒ‰æ—¶é—´å€’åºæ’åˆ—çš„æ‹¦æˆªè®°å½•
- æ¯æ¡æ˜¾ç¤ºï¼šæ“ä½œç±»å‹ï¼ˆå½©è‰²æ ‡ç­¾ï¼‰ã€æ–‡ä»¶åã€Agentã€å®Œæ•´è·¯å¾„ã€æ—¶é—´
- rename æ“ä½œæ˜¾ç¤ºç›®æ ‡è·¯å¾„
- ç­›é€‰å™¨ï¼šå…¨éƒ¨ / ä»… DELETE / ä»… MOVE
- æœ€å¤šæ˜¾ç¤ºæœ€è¿‘ 100 æ¡

### Tab 3: ç­–ç•¥ï¼ˆPolicyï¼‰

**æŸ¥çœ‹å’Œç®¡ç†ä¿æŠ¤ç­–ç•¥**ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿æŠ¤åŒºåŸŸ (10)                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  /Users/jqwang/0                     â”‚
â”‚  /Users/jqwang/1                     â”‚
â”‚  /Users/jqwang/2                     â”‚
â”‚  ...                                 â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  ä¸´æ—¶æ”¾è¡Œ (2)          [ æ¸…é™¤å…¨éƒ¨ ]   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  /Users/.../build.db          [ âœ• ]  â”‚
â”‚  /Users/.../ESGuardViewModel   [ âœ• ] â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â–¶ å—ä¿¡å·¥å…· (19)                      â”‚
â”‚    git, jj, cargo, rustup, ...       â”‚
â”‚  â–¶ AI Agent æ¨¡å¼ (3)                  â”‚
â”‚    codex, claude, claude-code        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å†…å®¹ï¼š
- `protected_zones` åˆ—è¡¨ï¼ˆæ¥è‡ªç­–ç•¥æ–‡ä»¶ï¼ŒNix ç®¡ç†ï¼‰
- `temporary_overrides` åˆ—è¡¨ + å•æ¡åˆ é™¤æŒ‰é’® + æ¸…é™¤å…¨éƒ¨
- `trusted_tools` æŠ˜å åˆ—è¡¨ï¼ˆå†…ç½®é»˜è®¤ + JSON è¦†ç›–ï¼‰
- `ai_agent_patterns` æŠ˜å åˆ—è¡¨

äº¤äº’ï¼š
- æ¸…é™¤å•æ¡/å…¨éƒ¨ `temporary_overrides`ï¼ˆç›´æ¥ä¿®æ”¹ JSONï¼‰
- ä¿æŠ¤åŒºåŸŸå’Œå—ä¿¡å·¥å…·ä»…å±•ç¤ºï¼ˆç”± Nix ç®¡ç†ï¼‰

### Tab 4: æ—¥å¿—ï¼ˆLogsï¼‰

**å®ˆæŠ¤è¿›ç¨‹è¿è¡Œæ—¥å¿—**ï¼ˆstdout/stderrï¼‰ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿è¡Œæ—¥å¿—              [ä»…é”™è¯¯] [ğŸ“‹]  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [policy] reloaded                   â”‚
â”‚  [DENY] unlink by rm (via claude):   â”‚
â”‚    /Users/.../test.txt               â”‚
â”‚  [policy] reloaded                   â”‚
â”‚  Codex-ES-Guard started [process-    â”‚
â”‚    aware mode]                       â”‚
â”‚  ...                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å†…å®¹ï¼š
- å®æ—¶è·Ÿè¸ª `/tmp/codex-es-guard.log` å’Œ `/tmp/codex-es-guard.err`
- `tail -f` æ¨¡å¼ï¼Œæœ€å¤šä¿ç•™æœ€è¿‘ 200 è¡Œ
- ç­›é€‰ï¼šå…¨éƒ¨ / ä»…é”™è¯¯ï¼ˆå« `[DENY]`ã€`error`ã€`panic`ï¼‰
- å¤åˆ¶æ—¥å¿—æŒ‰é’®

## 5. æ¶æ„è®¾è®¡

### 5.1 é¡¹ç›®ç»“æ„

```
codex-es-guard/
â”œâ”€â”€ src/main.rs                    # å®ˆæŠ¤è¿›ç¨‹ï¼ˆRustï¼Œå·²æœ‰ï¼‰
â”œâ”€â”€ es-guard-override              # Override è„šæœ¬ï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ es.plist                       # Entitlementsï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ Cargo.toml                     # Rust æ„å»ºï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ menubar-app/                   # æ–°å¢ï¼šMenuBar åº”ç”¨
â”‚   â”œâ”€â”€ Package.swift
â”‚   â””â”€â”€ Sources/
â”‚       â””â”€â”€ ESGuardMenuBar/
â”‚           â”œâ”€â”€ ESGuardMenuBarApp.swift      # @main å…¥å£
â”‚           â”œâ”€â”€ DashboardView.swift          # ä¸»è§†å›¾ + Tab å®¹å™¨
â”‚           â”œâ”€â”€ StatusPanel.swift            # Tab 1: çŠ¶æ€
â”‚           â”œâ”€â”€ RecordsPanel.swift           # Tab 2: è®°å½•
â”‚           â”œâ”€â”€ PolicyPanel.swift            # Tab 3: ç­–ç•¥
â”‚           â”œâ”€â”€ LogsPanel.swift              # Tab 4: æ—¥å¿—
â”‚           â”œâ”€â”€ ESGuardViewModel.swift       # æ•°æ®å±‚ ViewModel
â”‚           â””â”€â”€ Models.swift                 # DenialRecord, Policy æ¨¡å‹
â””â”€â”€ PLAN-menubar-app.md            # æœ¬æ–‡æ¡£
```

### 5.2 æ¨¡å—èŒè´£

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `ESGuardMenuBarApp.swift` | åº”ç”¨å…¥å£ï¼Œ`MenuBarExtra(.window)`ï¼Œå›¾æ ‡çŠ¶æ€ï¼ˆç»¿è‰²è¿è¡Œ/çº¢è‰²åœæ­¢/æ©™è‰²æœ‰æ‹¦æˆªï¼‰ |
| `DashboardView.swift` | ä¸»è§†å›¾å®¹å™¨ï¼šæ ‡é¢˜æ  + Segmented Picker + Tab å†…å®¹ + åº•éƒ¨æ“ä½œæ  |
| `ESGuardViewModel.swift` | æ‰€æœ‰æ•°æ®åŠ è½½/è½®è¯¢ï¼šè¿›ç¨‹çŠ¶æ€ã€è®°å½•è§£æã€ç­–ç•¥åŠ è½½ã€æ—¥å¿—è·Ÿè¸ªã€override è°ƒç”¨ |
| `Models.swift` | `DenialRecord`ã€`SecurityPolicy` æ•°æ®æ¨¡å‹ï¼ˆä¸ Rust ç«¯ JSON å¯¹é½ï¼‰ |
| å„ Panel | çº¯ UI è§†å›¾ï¼Œä» ViewModel è¯»å–æ•°æ® |

### 5.3 ViewModel è®¾è®¡

```swift
@MainActor
final class ESGuardViewModel: ObservableObject {
    // --- çŠ¶æ€ ---
    @Published var guardRunning: Bool = false
    @Published var records: [DenialRecord] = []
    @Published var policy: SecurityPolicy = .empty
    @Published var lastDenial: String = ""
    @Published var overrideMessage: String = ""

    // --- æ—¥å¿— ---
    @Published var logLines: [LogLine] = []
    @Published var showOnlyErrors: Bool = false

    // --- æ“ä½œ ---
    func reload()                          // æ‰‹åŠ¨åˆ·æ–°å…¨éƒ¨
    func requestOverride(for path: String)  // è°ƒç”¨ es-guard-override
    func removeOverride(_ path: String)     // ä» policy JSON åˆ é™¤å•æ¡ override
    func clearAllOverrides()                // æ¸…ç©ºå…¨éƒ¨ overrides

    // --- å†…éƒ¨ ---
    private func startPolling()             // 5s è½®è¯¢å¾ªç¯
    private func loadRecords() -> [DenialRecord]
    private func loadPolicy() -> SecurityPolicy
    private func loadFeedback() -> String
    private func checkGuardRunning() -> Bool
    private func startLogMonitoring()       // tail -f æ—¥å¿—
}
```

### 5.4 MenuBar å›¾æ ‡çŠ¶æ€

| çŠ¶æ€ | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|
| è¿è¡Œä¸­ + æ— æ‹¦æˆª | `shield.checkmark` (ç»¿è‰²) | æ­£å¸¸é˜²æŠ¤ |
| è¿è¡Œä¸­ + æœ‰æ–°æ‹¦æˆª | `shield.exclamationmark` (æ©™è‰²) | æœ€è¿‘æœ‰æ‹¦æˆª |
| å·²åœæ­¢ | `shield.slash` (çº¢è‰²) | å®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œ |

## 6. æ„å»ºä¸éƒ¨ç½²

### 6.1 å¼€å‘æœŸæ„å»º

```bash
cd codex-es-guard/menubar-app
swift build
# è¿è¡Œ
.build/arm64-apple-macosx/debug/ESGuardMenuBar
```

### 6.2 Nix é›†æˆï¼ˆåæœŸï¼‰

åœ¨ `flake.nix` ä¸­æ–°å¢ Swift åŒ…æ„å»ºï¼Œæˆ–ä½œä¸ºç‹¬ç«‹ derivationï¼š

```nix
packages.es-guard-menubar = pkgs.swiftPackages.stdenv.mkDerivation {
  # ...swift build...
};
```

ä¹Ÿå¯ä»¥å…ˆæ‰‹åŠ¨æ„å»º `.app`ï¼Œåç»­å†è€ƒè™‘ Nix é›†æˆã€‚

### 6.3 éƒ¨ç½²å½¢å¼

- å¼€å‘æœŸï¼šç›´æ¥ `swift build && open` è¿è¡Œ
- æ­£å¼éƒ¨ç½²ï¼šæ‰“åŒ…ä¸º `.app` bundleï¼Œæ”¾å…¥ `/Applications/` æˆ– `~/Applications/`
- å¯é€‰ï¼šé€šè¿‡ Nix activation script è‡ªåŠ¨å®‰è£…

## 7. ä¸ cliProxyAPI-Dashboard çš„å…³é”®å·®å¼‚

| ç»´åº¦ | cliProxyAPI-Dashboard | ES Guard MenuBar |
|------|----------------------|------------------|
| æ•°æ®æ¥æº | HTTP API (`/api/usage`) | æœ¬åœ°æ–‡ä»¶ (JSON/JSONL/æ–‡æœ¬) |
| ä¾èµ– | éœ€è¦åç«¯æœåŠ¡è¿è¡Œ | ä»…éœ€æœ¬åœ°æ–‡ä»¶ï¼Œæ— å¤–éƒ¨ä¾èµ– |
| å¤æ‚åº¦ | 5 ä¸ª Tab + API Key ç®¡ç† + æœåŠ¡æ§åˆ¶ | 4 ä¸ª Tabï¼Œæ›´ç²¾ç®€ |
| é€šçŸ¥ | æœåŠ¡å´©æºƒé€šçŸ¥ (UNNotification) | å¯é€‰ï¼šæ‹¦æˆªé€šçŸ¥ |
| é…ç½® | è¯»å– config.yaml | è¯»å– es_policy.json |
| å†™æ“ä½œ | ä¿®æ”¹ config.yaml (Key ç®¡ç†) | ä»…ä¿®æ”¹ temporary_overrides |

## 8. å®æ–½æ­¥éª¤

| é˜¶æ®µ | å†…å®¹ | ä¼°è®¡æ–‡ä»¶æ•° |
|------|------|-----------|
| Phase 1 | é¡¹ç›®è„šæ‰‹æ¶ï¼šPackage.swift + App å…¥å£ + ç©º Tab æ¡†æ¶ | 3 |
| Phase 2 | ViewModel + Modelsï¼šæ•°æ®åŠ è½½ã€è½®è¯¢ã€è®°å½•è§£æ | 2 |
| Phase 3 | StatusPanel + RecordsPanelï¼šæ ¸å¿ƒ UI | 2 |
| Phase 4 | PolicyPanel + LogsPanelï¼šç­–ç•¥å±•ç¤º + æ—¥å¿—è·Ÿè¸ª | 2 |
| Phase 5 | Override äº¤äº’ + MenuBar å›¾æ ‡åŠ¨æ€æ›´æ–° | ä¿®æ”¹å·²æœ‰ |
| Phase 6 | æµ‹è¯• + æ‰“åŒ… + éƒ¨ç½²é›†æˆ | - |

## 9. é£é™©ä¸æ³¨æ„äº‹é¡¹

1. **æ—  App Bundle é—®é¢˜**ï¼šç›´æ¥ `swift build` çš„äºŒè¿›åˆ¶æ²¡æœ‰ `.app` bundleï¼Œå¯èƒ½å¯¼è‡´ `UNUserNotificationCenter` å´©æºƒï¼ˆcliProxyAPI-Dashboard å·²é‡åˆ°ï¼‰ã€‚è§£å†³ï¼šä¸ä½¿ç”¨ `UNNotification`ï¼Œæˆ–ç”¨ `xcodebuild` æ‰“åŒ…
2. **ES Guard æœªè¿è¡Œæ—¶çš„ä½“éªŒ**ï¼šApp åº”ä¼˜é›…å¤„ç†å®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œçš„æƒ…å†µï¼Œæ˜¾ç¤ºå¼•å¯¼ä¿¡æ¯
3. **æ–‡ä»¶æƒé™**ï¼š`denials.jsonl` å’Œ `last_denial.txt` ç”± root è¿›ç¨‹å†™å…¥ï¼Œéœ€ç¡®ä¿å½“å‰ç”¨æˆ·å¯è¯»
4. **æ€§èƒ½**ï¼šè½®è¯¢é—´éš” 5 ç§’ï¼ŒJSONL æ–‡ä»¶å¯èƒ½å¢é•¿è¾ƒå¤§ï¼Œéœ€è®¾ä¸Šé™ï¼ˆå®ˆæŠ¤è¿›ç¨‹å·²æœ‰ 1MB è½®è½¬ï¼‰
5. **Swift 6 å¹¶å‘**ï¼šPackage.swift ä½¿ç”¨ `swift-tools-version: 6.0`ï¼Œéœ€æ³¨æ„ `@Sendable` å’Œ actor isolation
